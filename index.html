<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Media Storage Player</title>
</head>
<body>
<input type="file" id="fileInput" accept="audio/mp3, video/mp4" onchange="handleFileChange()">
<audio id="audioPlayer" controls></audio>
<video id="videoPlayer" controls width="320"></video>

<script>
  // Open (or create) the database
  const openRequest = indexedDB.open('MediaDB', 1);

  openRequest.onupgradeneeded = function(e) {
    const db = e.target.result;
    if (!db.objectStoreNames.contains('media')) {
      db.createObjectStore('media', { keyPath: 'id' });
    }
  };

  openRequest.onerror = function(e) {
    console.error('Error opening database:', e.target.errorCode);
  };

  function handleFileChange() {
    const fileInput = document.getElementById('fileInput');
    const files = fileInput.files;
    if (files.length > 0) {
      const file = files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const arrayBuffer = reader.result;
        storeData(file.name, arrayBuffer, file.type);
      };
      reader.readAsArrayBuffer(file);
    }
  }

  function storeData(name, data, type) {
    const transaction = openRequest.result.transaction('media', 'readwrite');
    const store = transaction.objectStore('media');
    const request = store.put({id: name, data: data, type: type});
    request.onsuccess = function() {
      console.log('File stored:', name);
      loadData(name);
    };
    request.onerror = function(e) {
      console.error('Error storing file:', e.target.errorCode);
    };
  }

  // Existing setup...

function loadNextMedia(currentName) {
  const transaction = openRequest.result.transaction('media', 'readonly');
  const store = transaction.objectStore('media');
  const getAllKeysRequest = store.getAllKeys();
  getAllKeysRequest.onsuccess = function() {
    const keys = getAllKeysRequest.result;
    let currentIndex = keys.indexOf(currentName);
    let nextIndex = currentIndex + 1;
    if (nextIndex >= keys.length) {
      nextIndex = 0; // Loop back to the first file
    }
    loadData(keys[nextIndex]); // Load the next file
  };
}

function loadData(name) {
  const transaction = openRequest.result.transaction('media', 'readonly');
  const store = transaction.objectStore('media');
  const request = store.get(name);
  request.onsuccess = function(e) {
    const record = e.target.result;
    if (record.type.startsWith('audio')) {
      const audioPlayer = document.getElementById('audioPlayer');
      audioPlayer.src = URL.createObjectURL(new Blob([record.data], {type: record.type}));
      audioPlayer.load();
      audioPlayer.play();
      audioPlayer.onended = () => loadNextMedia(name); // When one ends, load the next
    } else if (record.type.startsWith('video')) {
      const videoPlayer = document.getElementById('videoPlayer');
      videoPlayer.src = URL.createObjectURL(new Blob([record.data], {type: record.type}));
      videoPlayer.load();
      videoPlayer.play();
      videoPlayer.onended = () => loadNextMedia(name); // When one ends, load the next
    }
  };
  request.onerror = function(e) {
    console.error('Error loading file:', e.target.errorCode);
  };
}
</script>
</body>
</html>
